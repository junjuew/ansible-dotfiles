;; Tell emacs where is your personal elisp lib dir
(add-to-list 'load-path "~/.emacs.d/lisp/")

;; melpa package manager
(require 'package) ;; You might already have this line
(add-to-list 'package-archives
             '("melpa" . "https://melpa.org/packages/"))
(when (< emacs-major-version 24)
  ;; For important compatibility libraries like cl-lib
  (add-to-list 'package-archives '("gnu" . "http://elpa.gnu.org/packages/")))
(package-initialize) ;; You might already have this line

(defun require-package (p)
  (unless (package-installed-p p)
    (package-install p))
  (require p))

;; custom emacs package management
; initialize use-package
(if (not (package-installed-p 'use-package))
    (progn
      (package-refresh-contents)
      (package-install 'use-package)))
(require 'use-package)

; install needed package from melpha using use-package.el
(use-package sr-speedbar
  :ensure t)
; (use-package color-theme-sanityinc-solarized
;  :ensure t)
(use-package dark-mint-theme
  :ensure t)
(use-package jedi
  :ensure t)
(add-hook 'python-mode-hook 'jedi:setup)
(setq jedi:complete-on-dot t)                 ; optional

(use-package jedi-direx
  :ensure t)
(eval-after-load "python"
  '(define-key python-mode-map "\C-cx" 'jedi-direx:pop-to-buffer))
(add-hook 'jedi-mode-hook 'jedi-direx:setup)
             
; (load-theme 'sanityinc-solarized-dark t)
; (load-theme 'green-phosphor t)
(load-theme 'dark-mint t)


;; to enable the line number on the left
(global-linum-mode t)
;; show column number as well
(setq column-number-mode t)

;; to setup tabs
(setq c-basic-indent 4)
(setq tab-width 4)
(setq-default indent-tabs-mode nil)
(setq tab-stop-list (number-sequence 4 200 4))

;; dired copy to another buffer
(setq dired-dwim-target t)

;; set default fill-column
(setq-default fill-column 120)

;; verilog-mode
(add-hook 'verilog-mode-hook '(lambda ()
    (add-hook 'local-write-file-hooks (lambda()
       (untabify (point-min) (point-max))))))

;; recentf stuff
(recentf-mode 1)
(setq recentf-max-menu-items 25)
(global-set-key "\C-x\ \C-r" 'recentf-open-files)
    
(custom-set-variables
  ;; custom-set-variables was added by Custom.
  ;; If you edit it by hand, you could mess it up, so be careful.
  ;; Your init file should contain only one such instance.
  ;; If there is more than one, they won't work right.
 '(indent-tabs-mode nil)
 '(inhibit-startup-screen t)
 '(tab-always-indent t))
(custom-set-faces
  ;; custom-set-faces was added by Custom.
  ;; If you edit it by hand, you could mess it up, so be careful.
  ;; Your init file should contain only one such instance.
  ;; If there is more than one, they won't work right.
 )

(defun my-indent-region (N)
  (interactive "p")
  (if mark-active
      (progn (indent-rigidly (min (mark) (point)) (max (mark) (point)) (* N 4))
             (setq deactivate-mark nil))
    (self-insert-command N)))

(defun my-unindent-region (N)
  (interactive "p")
  (if mark-active
      (progn (indent-rigidly (min (mark) (point)) (max (mark) (point)) (* N -4))
             (setq deactivate-mark nil))
    (self-insert-command N)))

;;something wrong with the syntax
;;(global-set-key (kbd "C-c >") 'my-indent-region)
;;(global-set-key (kdb "C-c <") 'my-unindent-region)

(defun comment-or-uncomment-region-or-line ()
    "Comments or uncomments the region or the current line if there's no active region."
    (interactive)
    (let (beg end)
        (if (region-active-p)
            (setq beg (region-beginning) end (region-end))
            (setq beg (line-beginning-position) end (line-end-position)))
        (comment-or-uncomment-region beg end)
        (next-line)))

(global-set-key (kbd "<f9>") 'calendar)
(global-set-key (kbd "C-c /") 'comment-region)
(global-set-key (kbd "C-c '") 'uncomment-region)
(global-set-key (kbd "C-c /") 'comment-or-uncomment-region-or-line)

;;change default color
;;(add-to-list 'default-frame-alist '(foreground-color . "orange"))
;;(add-to-list 'default-frame-alist '(background-color . "black"))

;enlarge default font
(set-face-attribute 'default nil :height 130)

(setq backup-directory-alist '(("." . "~/.emacs.d/backup"))
  backup-by-copying t    ; Don't delink hardlinks
  version-control t      ; Use version numbers on backups
  delete-old-versions t  ; Automatically delete excess backups
  kept-new-versions 20   ; how many of the newest versions to keep
  kept-old-versions 5    ; and how many of the old
 )

(setq x-select-enable-clipboard t)
(cua-selection-mode t)
; enable global cursor line highlighting mode
(global-hl-line-mode t)

;python mode auto indentation
(add-hook 'python-mode-hook '(lambda () (define-key python-mode-map "\C-m" 'newline-and-indent)))

;; set default tramp mode to be ssh to make it faster
(setq tramp-default-method "ssh")

;; cleaner UI
(menu-bar-mode -1)
(toggle-scroll-bar -1)
(tool-bar-mode -1)


;enable ispell
;; (setq ispell-program-name "/usr/bin/aspell")

; enable flyspell
;;(dolist (hook '(text-mode-hook))
;;  (add-hook hook (lambda () (flyspell-mode 1))))
;;(dolist (hook '(change-log-mode-hook log-edit-mode-hook))
;;  (add-hook hook (lambda () (flyspell-mode -1))))

;; org-mode
(global-set-key "\C-cl" 'org-store-link)
(global-set-key "\C-ca" 'org-agenda)
(global-set-key "\C-cc" 'org-capture)
(global-set-key "\C-cb" 'org-iswitchb)

;quickly move between windows S-up, S-down, S-left, S-right (S for Shift)
(windmove-default-keybindings)

;; latex mode
;; (require-package 'auto-complete-auctex)

;; autocomplete for emacs
(require-package 'auto-complete)
(require 'auto-complete-config)
(ac-config-default)
(setq-default ac-sources
          '(
        ac-source-filename
        ac-source-abbrev 
        ac-source-dictionary
        ac-source-words-in-same-mode-buffers))

(require-package 'ac-math) 
(add-to-list 'ac-modes 'latex-mode)   ; make auto-complete aware of `latex-mode`

;; predictive abbreviation expansion
(require-package 'pabbrev)
(require 'pabbrev)

(defun ac-LaTeX-mode-setup () ; add ac-sources to default ac-sources
  (setq ac-sources
        (append '(ac-source-math-unicode ac-source-math-latex ac-source-latex-commands)
                ac-sources)))
(add-hook 'LaTeX-mode-hook 'ac-LaTeX-mode-setup)
(dolist (m '(c-mode c++-mode java-mode))
  (add-to-list 'ac-modes m))
(global-auto-complete-mode t)
(setq ac-math-unicode-in-math-p t)

; only supported for emacs 24.4 above
;(global-set-key (kbd "C-*") 'isearch-forward-symbol-at-point)

; alias all yes to no to y or n
(defalias 'yes-or-no-p 'y-or-n-p)
